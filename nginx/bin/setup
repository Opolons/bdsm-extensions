#!/usr/bin/env bash

source "$extension_scripts_path/initialize"

if [[ -s "$extension_templates_path/nginx.conf.template" ]] ; then

  for directory in "$nginx_config_path" "$nginx_servers_path" ; do

    if [[ ! -d "$directory" ]] ; then

      mkdir -p "$directory"

    fi

  done

  # nginx.conf.template => /etc/nginx.conf
  cp "$extension_templates_path/nginx.conf.template" \
    "/etc/nginx/"

  # nginx_ctl.template => /etc/init.d/nginx
  if [[ -d /etc/init.d ]] ; then

    # Copy the NGINX control script to the init.d directory
    cp "$extension_templates_path/nginx_ctl.template" \
      "/etc/init.d/"

    chmod +x /etc/init.d/nginx

  elif [[ -d /etc/rc.d ]] ; then

    # Copy the NGINX control script to the rc.d directory
    cp "$extension_templates_path/nginx_ctl.template" \
      "/etc/rc.d/"

    chmod +x /etc/rc.d/nginx

  else

    printf "WARN: Did not find /etc/init.d nor /etc/rc.d to place the init script.\n"

  fi

  # ${template}.template => /etc/nginx/conf/${template}
  for template in proxy.conf mime.types ; do
    cp "$extension_templates_path/${template}.template" \
      "/etc/nginx/conf/"
  done

  exit $?

else

  printf "ERROR: $extension_templates_path/nginx.conf.template is missing.\n"

  exit 1

fi

